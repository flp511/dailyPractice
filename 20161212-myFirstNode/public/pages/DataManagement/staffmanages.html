<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>员工管理</title>
    <link rel="stylesheet" href="../../css/bootstrap.css"/>
    <link rel="stylesheet" href="../../css/data-base.css"/>
    <script src="../../js/jquery-3.1.1.js"></script>
    <script src="../../js/layer/layer.js"></script>
    <script src="../../js/bootstrap.js"></script>
</head>
<body>
<!-- Modal -->
<div class="fullbox">
    <h1 class="col-sm-12 col-xs-12"><span class="glycolor glyphicon glyphicon-align-left"></span>&nbsp;职工管理</h1>
<div class="modal fade" id="myStaffMan" tabindex="-1" role="dialog"
     aria-labelledby="staffLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="staffLabel">员工信息</h4>
            </div>
            <div class="modal-body">
                <form action="post">
                    <div class="form-group">
                        <lable>员工ID <sup class="data-star">*</sup>：</lable>
                        <input type="text" id="id" class="form-control">
                    </div>
                    <div class="row">
                        <div class="form-group col-lg-6 col-sm-6">
                            <lable>姓名<sup class="data-star">*</sup>：</lable>
                            <input type="text" id="name" class="form-control">
                        </div>
                        <div class="form-group col-lg-6 col-sm-6">
                            <lable>性别<sup class="data-star">*</sup>：</lable>
                            <input type="text" id="sex" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <lable>电话<sup class="data-star">*</sup>：</lable>
                        <input type="text" id="tel" class="form-control">
                    </div>
                    <div class="form-group">
                        <lable>员工Email：</lable>
                        <div class="input-group">
                            <div class="input-group-addon">@</div>
                            <input class="form-control" lay-verify id="email" type="email">
                            <p style="font-size: 12px;color: red;margin: 0"></p>
                        </div>
                    </div>
                    <div class="form-group">
                        <lable>激活状态：</lable>
                        <input type="text" id="activated" class="form-control">
                    </div>
                    <div class="form-group">
                        <lable>职务：</lable>
                        <input type="text" id="duty" class="form-control">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" id="editSave"  class="btn btn-success">保存变更</button>
            </div>
        </div>
    </div>
</div>
<!--end Modal-->

<!-- Modal -->
<div class="modal fade" id="myaddStaffMan" tabindex="-1" role="dialog"
     aria-labelledby="myaddStaffManLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myaddStaffManLabel">员工信息</h4>
            </div>
            <div class="modal-body">
                <form action="post">
                    <div class="form-group">
                        <lable>员工ID <sup class="data-star">*</sup>：</lable>
                        <input type="text" id="addid" class="form-control">
                    </div>
                    <div class="row">
                        <div class="form-group col-lg-6 col-sm-6">
                            <lable>姓名<sup class="data-star">*</sup>：</lable>
                            <input type="text" id="addname" class="form-control">
                        </div>
                        <div class="form-group col-lg-6 col-sm-6">
                            <lable>性别<sup class="data-star">*</sup>：</lable>
                            <input type="text" id="addsex" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <lable>电话<sup class="data-star">*</sup>：</lable>
                        <input type="text" id="addtel" class="form-control">
                    </div>
                    <div class="form-group">
                        <lable>员工Email：</lable>
                        <div class="input-group">
                            <div class="input-group-addon">@</div>
                            <input class="form-control" id="addemail" type="email">
                            <p style="font-size: 12px;color: red;margin: 0"></p>
                        </div>
                    </div>
                    <div class="form-group">
                        <lable>激活状态：</lable>
                        <input type="text" id="addactivated" class="form-control">
                    </div>
                    <div class="form-group">
                        <lable>职务：</lable>
                        <input type="text" id="addduty" class="form-control">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" id="addSave" class="btn btn-success">保存变更</button>
            </div>
        </div>
    </div>
</div>
<!--end Modal-->

<div class="data-contexte">
    <!--搜索框-->
    <div class="data-secr">
        <form action="post" class="form-inline">
            <div class="form-group">
                <lable>员工ID：</lable>
                <input type="text" class="form-control">
            </div>
            <div class="form-group">
                <lable>姓名：</lable>
                <input type="text" class="form-control">
            </div>
            <div class="form-group">
                <lable>职务：</lable>
                <input type="text" class="form-control">
            </div>
             <span class="data-pointer">
                <span class="glyphicon glyphicon-search glyphicon data-pointer"></span>
                 搜索
            </span>
        </form>
    </div>
    <!--end搜索框-->
    <!--数据表格-->
    <div class="table-responsive data-tableRadius">
        <table class="table table-striped table-bordered">
            <thead class="data-tabhead">
            <tr>
                <td>员工ID</td>
                <td>姓名</td>
                <td>性别</td>
                <td>电话号码</td>
                <td>Email</td>
                <td>激活状态</td>
                <td>职务</td>
                <td>编辑</td>
            </tr>
            </thead>
            <tbody id="mytbody">

            </tbody>
        </table>
        <div class="data-divpage">
            <span>上一页</span>
            <a href="javascript:;">1</a>
            <a href="javascript:;">2</a>
            <a href="javascript:;">3</a>
            <a href="javascript:;">4</a>
            <a href="javascript:;">5</a>
            ....
            <a href="javascript:;">9</a>
            <span>下一页</span>
        </div>
    </div>
    <button class="data-edit data-bw" data-toggle="modal" data-target="#myaddStaffMan">新增员工</button>
</div>
</div>
</body>
<script>
    //loadstaff
    var pageNum=1;
    var maxPageNum;
    var myTboby=$("#mytbody").get(0);
    function laodData(){
        $.ajax({
            url: "load_staff.do",
            type: "post",
            data: {myPageNum:pageNum},
            datatype: "json",//返回的数据类型
            async: "true",
            cache: "false",
            success: function (data) {
                var innerhtml = "";
                for(var i=0; i<data.length; i++){
                    innerhtml +=
                    "<tr>" +
                    "<td>"+data[i].s_id+"</td>" +
                    "<td>"+data[i].s_name+"</td>" +
                    "<td>"+data[i].s_sex+"</td>" +
                    "<td>"+data[i].s_tel+"</td>" +
                    "<td>"+data[i].s_email+"</td>" +
                    "<td>"+data[i].s_state+"</td>" +
                    "<td>"+data[i].j_name+"</td>" +
                    "<td><div class='data-edit' data-toggle='modal'  onclick='edit(this)' data-target='#myStaffMan'>编辑</div></td>" +
                    "</tr>"
                }
                myTboby.innerHTML=innerhtml;
            }
        });
    }
    laodData();
    //删除
    function del(obj){
        $(obj).parent().parent().remove();
    }
    //编辑
   function edit(obj){
        var id=$(obj).parent().parent().find('td:nth-child(1)').text();
        var name=$(obj).parent().parent().find('td:nth-child(2)').text();
        var sex=$(obj).parent().parent().find('td:nth-child(3)').text();
        var tel=$(obj).parent().parent().find('td:nth-child(4)').text();
        var email=$(obj).parent().parent().find('td:nth-child(5)').text();
        var activated=$(obj).parent().parent().find('td:nth-child(6)').text();
        var duty=$(obj).parent().parent().find('td:nth-child(7)').text();
        $('#id').val(id);
        $('#name').val(name);
        $('#sex').val(sex);
        $('#tel').val(tel);
        $('#email').val(email);
        $('#activated').val(activated);
        $('#duty').val(duty);
        $('tr').attr('active','0');
        $(obj).parent().parent().attr('active','1');
    }
    layer.config({
        skin: 'layui-layer-molv'
    })
    //编辑保存
   function editSave(){
        var id=$('#id').val();
        var name=$('#name').val();
        var sex=$('#sex').val();
        var tel=$('#tel').val();
        var email=$('#email').val();
        var activated=$('#activated').val();
        var duty=$('#duty').val();
       $.ajax({
           url:"update_staff.do",
           type:"post",
           data:{myid:id,myname:name,mysex:sex,mytel:tel,myemail:email,myactivated:activated,myduty:duty},
           dataType:"json",
           async:"true",
           cache:"true",
           success:function(data){

           }
       });
       laodData();
    }
    $('#editSave').on('click',function(){
        layer.open({
            title:'警告'
            ,content:'确定保存变更吗？'
            ,btn:['确定','取消']
            ,offset:'20%'
            ,yes:function(index,layero){
                editSave();
                layer.close(index)
            }
        })
    });
    //新增
    $('#addSave').click(function () {
        layer.open({
            title:'警告'
            ,content:'确定保存变更吗？'
            ,btn:['确定','取消']
            ,offset:'20%'
            ,yes:function(index,layero){
                var id=$('#addid').val();
                var name=$('#addname').val();
                var sex=$('#addsex').val();
                var tel=$('#addtel').val();
                var email=$('#addemail').val();
                var activated=$('#addactivated').val();
                var duty=$('#addduty').val();
                var a=" <tr><td>"+id+"</td> <td>"+name+"</td><td>"+sex+"</td> <td>"+tel+"</td> <td>"+email+"</td><td>"+activated+"</td><td>"+duty+"</td> <td> <div class='data-edit' data-toggle='modal' data-target='#myStaffMan' onclick='edit(this)'>编辑</div> </td></tr>"
                $('#mytbody').append(a);
                layer.close(index)
            }
        })
    });
    //验证
    $('#email').blur(function(){
        regname(this,'email');
    });
    $('#addemail').blur(function(){
        regname(this,'email');
    });
    function regname(obj,type){
        var text;
        var value=$(obj).val();
        if(type=="email"){
            text="邮箱格式不正确";
        }
        var a=reg(value,type);
        if(!a){
            $(obj).next().text(text);
        }else if(a){
            $(obj).next().text("");
        }
    }
    function reg(a,type){

        var reg;
        if(type=="email"){
            reg=/\w+((-w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+/;
        }
        return reg.test(a);

    }
</script>
</html>