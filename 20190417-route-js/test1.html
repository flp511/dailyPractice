<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        body {
            display: flex;
            justify-content: center;
        }

        #target {
            margin-top: 100px;
            font-family: "Helvetica Neue", sans-serif;
            font-weight: 100;
            font-size: 150px;
            color: #777;
            -webkit-font-smoothing: antialiased;
        }

        #target:hover {
            color: orange;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div id="target">ROTATE ME!</div>
</body>
<script>
    // Generated by CoffeeScript 1.6.3
    (function () {
        var R2D, active, angle, center, init, rotate, rotation, start, startAngle, stop;

        active = false;

        angle = 0;

        rotation = 0;

        startAngle = 0;

        center = {
            x: 0,
            y: 0
        };

        // document.ontouchmove = function (e) {
        //     return e.preventDefault();
        // };

        init = function (target) {
            target.addEventListener("mousedown", start, false);
            target.addEventListener("mousemove", rotate, false);
            return target.addEventListener("mouseup", stop, false);
        };

        R2D = 180 / Math.PI;

        start = function (e) {
            var height, left, top, width, x, y, _ref;
            e.preventDefault();
            _ref = this.getBoundingClientRect(), top = _ref.top, left = _ref.left, height = _ref.height, width = _ref.width;
            
            console.log(_ref);

            center = {
                x: left + (width / 2),
                y: top + (height / 2)
            };
            x = e.clientX - center.x;
            y = e.clientY - center.y;
            startAngle = R2D * Math.atan2(y, x);
            console.log('startAngle:', startAngle);
            return active = true;
        };

        rotate = function (e) {
            var d, x, y;
            e.preventDefault();
            x = e.clientX - center.x;
            y = e.clientY - center.y;
            d = R2D * Math.atan2(y, x);
            rotation = d - startAngle;
            console.log('rotate:', d, rotation);
            if (active) {
                return this.style.webkitTransform = "rotate(" + (angle + rotation) + "deg)";
            }
        };

        stop = function () {
            angle += rotation;
            return active = false;
        };

        init(document.getElementById('target'));

    }).call(this);

</script>

</html>